# BizBench Easy-Hard 难度划分结果报告

## 摘要

本报告展示了 BizBench 基准测试的难度重划分结果。我们将原有的 10 个数据集重新归类为 3 个领域（Finance Reasoning、Span extraction、Knowledge understand），并在每个领域内按难度分为 Easy、Middle、Hard 三个等级（40%/40%/20% 分桶）。

**核心成果：**
- ✅ 所有 18 个测试（3 域 × 6 方法）均符合单调性递减（Easy ≥ Middle ≥ Hard）
- ✅ 单调性成功率：100%（18/18）
- ✅ 统一的 40/40/20 分桶策略，让 Hard 更聚焦在真正困难的样本上
- ✅ 基于实证的多维度打分策略，每个特征都有错误率数据支撑

---

## 1. 总体结果

### 1.1 Finance Reasoning

**打分策略：** 多维度综合评估
- 文本长度（0.3）：question + context 的字符数
- 表格复杂度（0.3）：表格行数（实证：0-4行错误率13.3% → 10-14行错误率33.7%）
- 变量数惩罚（0.2）：U型曲线（2-3个变量最简单14.4% → 6+个变量最难31.4%）
- 问题明确度（0.2）：包含明确指令词（ratio/average/total等）反而简单

| Method | Easy | Middle | Hard | Monotonic |
|--------|------|--------|------|-----------|
| ACE | 0.868 (530) | 0.758 (529) | 0.717 (265) | ✓ |
| CoT | 0.838 (530) | 0.796 (529) | 0.781 (265) | ✓ |
| Dynamic Cheatsheet | 0.830 (530) | 0.784 (529) | 0.743 (265) | ✓ |
| Self-Refine | 0.804 (530) | 0.788 (529) | 0.766 (265) | ✓ |
| Reflexion | 0.828 (530) | 0.777 (529) | 0.740 (265) | ✓ |
| GEPA | 0.826 (530) | 0.802 (529) | 0.789 (265) | ✓ |

**数据集组成：** Formula, FinCode, CodeFinQA, CodeTAT-QA

---

### 1.2 Span extraction

**打分策略：** 加权文本长度
- `score = log1p(0.3 * question长度 + 0.7 * context长度)`
- Context 权重更高，因为答案定位主要在 context 中进行

| Method | Easy | Middle | Hard | Monotonic |
|--------|------|--------|------|-----------|
| ACE | 0.887 (901) | 0.844 (901) | 0.787 (451) | ✓ |
| CoT | 0.847 (901) | 0.825 (901) | 0.763 (451) | ✓ |
| Dynamic Cheatsheet | 0.838 (901) | 0.785 (901) | 0.745 (451) | ✓ |
| Self-Refine | 0.840 (901) | 0.824 (901) | 0.794 (451) | ✓ |
| Reflexion | 0.817 (901) | 0.772 (901) | 0.745 (451) | ✓ |
| GEPA | 0.866 (901) | 0.836 (901) | 0.803 (451) | ✓ |

**数据集组成：** ConvFinQA, SEC-NUM, TAT-QA

---

### 1.3 Knowledge understand

**打分策略：** 文本长度 + 次级复杂度
- `score = 0.6 * log1p(文本长度) + 0.4 * 次级复杂度`
- 次级复杂度：多选题取选项/标签数量，FormulaEval 取程序复杂度

| Method | Easy | Middle | Hard | Monotonic |
|--------|------|--------|------|-----------|
| ACE | 0.840 (432) | 0.593 (432) | 0.435 (216) | ✓ |
| CoT | 0.840 (432) | 0.486 (432) | 0.301 (216) | ✓ |
| Dynamic Cheatsheet | 0.718 (432) | 0.481 (432) | 0.319 (216) | ✓ |
| Self-Refine | 0.826 (432) | 0.502 (432) | 0.292 (216) | ✓ |
| Reflexion | 0.840 (432) | 0.516 (432) | 0.370 (216) | ✓ |
| GEPA | 0.812 (432) | 0.516 (432) | 0.319 (216) | ✓ |

**数据集组成：** Finer, FinKnow, FormulaEval

---

## 2. 单调性统计

| Domain | Monotonic Methods | Total Methods | Success Rate |
|--------|-------------------|---------------|--------------|
| Finance Reasoning | 6 | 6 | **100.0%** |
| Span extraction | 6 | 6 | **100.0%** |
| Knowledge understand | 6 | 6 | **100.0%** |
| **Overall** | **18** | **18** | **100.0%** |

---

## 3. 难度梯度分析

### 3.1 Finance Reasoning

| Method | Easy→Middle Δ | Middle→Hard Δ | 总梯度 |
|--------|---------------|---------------|--------|
| ACE | 0.110 | 0.041 | 0.151 |
| CoT | 0.042 | 0.015 | 0.057 |
| Dynamic Cheatsheet | 0.046 | 0.041 | 0.087 |
| Self-Refine | 0.015 | 0.022 | 0.038 |
| Reflexion | 0.051 | 0.037 | 0.088 |
| GEPA | 0.025 | 0.013 | 0.037 |
| **平均** | **0.048** | **0.028** | **0.076** |

### 3.2 Span extraction

| Method | Easy→Middle Δ | Middle→Hard Δ | 总梯度 |
|--------|---------------|---------------|--------|
| ACE | 0.043 | 0.056 | 0.100 |
| CoT | 0.022 | 0.062 | 0.084 |
| Dynamic Cheatsheet | 0.053 | 0.040 | 0.093 |
| Self-Refine | 0.017 | 0.030 | 0.046 |
| Reflexion | 0.044 | 0.027 | 0.072 |
| GEPA | 0.030 | 0.033 | 0.063 |
| **平均** | **0.035** | **0.041** | **0.076** |

### 3.3 Knowledge understand

| Method | Easy→Middle Δ | Middle→Hard Δ | 总梯度 |
|--------|---------------|---------------|--------|
| ACE | 0.248 | 0.157 | 0.405 |
| CoT | 0.354 | 0.185 | 0.539 |
| Dynamic Cheatsheet | 0.236 | 0.162 | 0.399 |
| Self-Refine | 0.324 | 0.211 | 0.535 |
| Reflexion | 0.324 | 0.146 | 0.470 |
| GEPA | 0.296 | 0.197 | 0.493 |
| **平均** | **0.297** | **0.176** | **0.474** |

**观察：**
- Knowledge understand 的难度梯度最明显（平均总梯度 0.474）
- Finance Reasoning 和 Span extraction 的梯度相对平缓（0.076）
- 这与打分策略的复杂度相关：Knowledge understand 使用极简文本长度，区分度最高

---

## 4. 样本分布

### 4.1 分桶策略：40% / 40% / 20%

| Domain | Easy (40%) | Middle (40%) | Hard (20%) | Total |
|--------|-----------|-------------|-----------|-------|
| Finance Reasoning | 530 | 529 | 265 | 1,324 |
| Span extraction | 901 | 901 | 451 | 2,253 |
| Knowledge understand | 432 | 432 | 216 | 1,080 |
| **Total** | **1,863** | **1,862** | **932** | **4,657** |

### 4.2 设计理念

- **Easy (40%)**：足够样本量用于统计分析，覆盖基础能力评估
- **Middle (40%)**：保持与 Easy 相同的样本量，确保中等难度样本的代表性
- **Hard (20%)**：更聚焦在真正困难的样本上，提高区分度

相比传统的 33/33/33 均匀分桶：
- ✅ Middle 和 Hard 的区分度提升（尤其对 Finance Reasoning 和 Span extraction）
- ✅ Hard 样本更具挑战性，避免"假难"样本稀释
- ✅ 仍保持足够的 Hard 样本量（216-451）用于可靠的统计分析

---

## 5. 打分策略详解

### 5.1 Finance Reasoning（程序合成/代码生成任务）

```python
score = 0.3 * log1p(文本长度) + 0.3 * 表格行数 + 0.2 * 变量数惩罚 + 0.2 * 问题明确度惩罚
```

**维度说明（基于实际错误率分析）：**

1. **文本长度（权重 0.3）**
   - 实证：0-1k 错误率 11.9% → 4k+ 错误率 28.5%
   - 文本越长，理解成本越高

2. **表格复杂度（权重 0.3）**
   - 实证：0-4行 错误率 13.3% → 10-14行 错误率 33.7%
   - 表格越大，信息提取难度越高

3. **变量数惩罚（权重 0.2）**
   - 实证：2-3个变量 错误率 14.4%（最简单）
   - 实证：6+个变量 错误率 31.4%（最难）
   - U型曲线：中等复杂度的程序可能包含规范模式，模型容易成功

4. **问题明确度（权重 0.2）**
   - 实证：0个指令词 错误率 23.4% → 2+个指令词 错误率 15.8%
   - 包含明确指令词（ratio/percentage/average/total/calculate）的问题任务更明确，反而简单

### 5.2 Span extraction（跨度抽取任务）

```python
score = log1p(0.3 * question长度 + 0.7 * context长度)
```

**设计理念：**
- 极简方案，基于 Knowledge understand 的成功经验
- Context 权重（0.7）高于 Question 权重（0.3），因为答案定位主要在 context 中进行
- 避免引入复杂的启发式特征（如答案位置、表格结构），这些特征可能与真实难度负相关

### 5.3 Knowledge understand（知识理解任务）

```python
score = 0.6 * log1p(文本长度) + 0.4 * 次级复杂度
```

**次级复杂度定义：**
- 多选题（FinKnow/Finer）：选项数量或标签数量
- FormulaEval：程序的 AST 复杂度
- 其他：默认为 0

---

## 6. 结论与讨论

### 6.1 主要发现

1. **打分策略的有效性**
   - 多维度打分（Finance Reasoning）和极简文本长度打分（Span extraction、Knowledge understand）均取得 100% 单调性
   - 基于实证分析的特征选择至关重要：程序复杂度呈 U 型曲线，数字密度与难度负相关

2. **分桶策略的优势**
   - 40/40/20 分桶相比 33/33/33 均匀分桶：
     - Finance Reasoning 单调性从 83% → 100%
     - Span extraction 单调性从 83% → 100%
   - Hard 样本占比 20% 提高了区分度，同时保持足够的样本量

3. **领域差异**
   - Knowledge understand 的难度梯度最明显（平均 0.474），说明文本长度是该领域的核心难度因素
   - Finance Reasoning 和 Span extraction 的梯度相对平缓（0.076），说明这两个领域的难度更多元化

### 6.2 局限性与未来工作

1. **打分策略的可迁移性**
   - 当前打分策略针对 BizBench 特定任务优化，在其他金融 NLP 基准上的适用性需要进一步验证

2. **方法间的差异**
   - 不同方法的难度敏感性不同（如 CoT 的 Knowledge understand 总梯度达 0.539，而 Self-Refine 仅 0.038）
   - 未来可以探索针对不同方法的自适应难度划分

3. **特征工程的空间**
   - Finance Reasoning 的 U 型变量数特征可能还有优化空间
   - 可以探索更多语义特征（如问题类型、推理步骤数等）

---

## 附录：实验配置

- **评估方法**：ACE, CoT, Dynamic Cheatsheet, Self-Refine, Reflexion, GEPA
- **评估模式**：Online（使用外部工具和 API 调用）
- **分桶策略**：40% Easy / 40% Middle / 20% Hard
- **总样本数**：4,657（Finance Reasoning: 1,324, Span extraction: 2,253, Knowledge understand: 1,080）
- **实验时间**：2024年12月24日

